"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fadein(e){var t=0,n=function(){return e.filters?function(){e.style.filter="alpha(opacity="+100*t+")"}:function(){e.style.opacity=t}}();clearInterval(fadeinTimer),fadeinTimer=setInterval(function(){n(),t+=.1,t>1&&clearInterval(fadeinTimer)},50)}function fadeout(e){var t=1,n=function(){return e.filters?function(){e.style.filter="alpha(opacity="+100*t+")"}:function(){e.style.opacity=t}}();clearInterval(fadeoutTimer),fadeoutTimer=setInterval(function(){n(),t-=.1,t<0&&clearInterval(fadeoutTimer)},50)}function start(){clearInterval(timer),timer=setInterval(function(){pointers[index].removeAttribute("class"),fadeout(slides[index]),++index<3||(index=0),fadein(slides[index]),pointers[index].setAttribute("class","z-sel")},5e3)}function bind(){for(var e=function(e,t){pointers[e].addEventListener("click",function(){clearInterval(timer),fadeout(slides[index]),pointers[index].removeAttribute("class"),fadein(slides[e]),pointers[e].setAttribute("class","z-sel"),index=e,start()})},t=0,n=slides.length;t<n;t++)e(t,n);box.addEventListener("mouseenter",function(){clearInterval(timer)}),box.addEventListener("mouseleave",function(){start()})}function hasClass(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function addClass(e,t){hasClass(e,t)||(e.className+=" "+t)}function removeClass(e,t){if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}}function _query(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return _.exp(config.open+["#([\\s\\S])+?","([^{#}])*?"][e]+config.close)}function rtpl(e){return _.isType("string",e)?new Tpl(e):_.warn("Render","template should be String")}function _parse(e){if("object"===("undefined"==typeof e?"undefined":_typeof(e))){var t="";for(var n in e)t+=n+"="+e[n]+"&";return t}_.warn("HTTP","data must be an Object")}function http(e){return new Promise(function(t,n){var i=new XMLHttpRequest,a=e.data?_parse(e.data):"";e.type=e.type||"GET","GETget".indexOf(e.type)!==-1?(i.open(e.type,e.url+=a?"?"+a:"",!0),i.send(null)):"POSTpost".indexOf(e.type)!==-1&&(i.open(e.type,e.url,!0),i.send(a)),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207||304===i.status?t("JSONjson".indexOf(e.dataType)!==-1?JSON.parse(i.responseText):i.responseText):n(i.status))}})}function _warn(e){return _.warn("Page",e)}function isLargeScreen(){return document.body.offsetWidth>1205}function _render(e){return new Promise(function(t,n){http({url:"http://study.163.com/webDev/couresByCategory.htm",data:{pageNo:e,psize:psize,type:classType},type:"GET",dataType:"json"}).then(function(e){renderList.innerHTML=rtpl(["{{# for (var i = 0, len = data.list.length; i < len; i++) {}}","{{# var item = data.list[i]}}","<li>",'<img src="{{item.bigPhotoUrl}}" alt="">','<div class="info">','<p class="tt">{{item.name}}</p>','<p class="author">{{item.provider}}</p>','<span class="u-learnning">','<i class="icon"></i>',"<span>{{item.learnerCount}}</span>","</span>","{{# if (item.price) {}}",'<em class="price">￥{{item.price}}</em>',"{{# } else {}}",'<em class="price">免费</em>',"{{# }}}","</div>",'<div class="hover-box">','<div class="top">','<img class="hover-img" src="{{item.bigPhotoUrl}}" alt="">','<div class="info-box">',"<h6>{{item.name}}</h6>",'<div class="u-learnning">','<i class="icon"></i>',"<span>{{item.learnerCount}}人在学</span>","</div>",'<p class="author">发布者：{{item.provider}}</p>','<p class="type">适合人群：{{item.targetUser}}</p>',"</div>","</div>",'<div class="bottom">','<p class="desc">{{item.description}}</p>',"</div>","</div>","</li>","{{# }}}"].join("")).render(e),t(e.totalPage)},function(e){console.log(e)})})}function bind$1(){var e=classTab.querySelectorAll("li");window.onresize=function(){var e=isLargeScreen();e===!screenCache&&(screenCache=e,psize=screenCache?20:15,_render(curr))},classTab.addEventListener("click",function(t){for(var n=t||window.event,i=0,a=e.length;i<a;i++)e[i].removeAttribute("class");n.target.setAttribute("class","z-sel"),classType=parseInt(n.target.getAttribute("data-type")),_init()})}function _init(){_render(1).then(function(e){new Page({el:pageBox,total:e,max:8,jump:function(e){curr=e,_render(e)}})})}function renderTopBox(){http({url:"http://study.163.com/webDev/hotcouresByCategory.htm",type:"GET",dataType:"json"}).then(function(e){topBox.innerHTML=rtpl(["{{# for (var i = 0, len = data.length; i < len; i++) {}}","<li>",'<img src="{{data[i].smallPhotoUrl}}" alt="">','<div class="box">','<p class="tt">{{data[i].name}}</p>','<div class="u-learnning">','<i class="icon"></i>',"<span>{{data[i].learnerCount}}</span>","</div>","</div>","</li>","{{# }}}"].join("")).render(e),animate()},function(e){console.log(e)})}function animate(){setInterval(function(){topBox.scrollTop<700?scroll():scrollInit()},5e3)}function scroll(){var e=topBox.scrollTop+70,t=setInterval(function(){topBox.scrollTop+=2,topBox.scrollTop>=e&&clearInterval(t)},20)}function scrollInit(){var e=setInterval(function(){topBox.scrollTop-=30,topBox.scrollTop<=0&&clearInterval(e)},20)}function hex_md5(e){return binl2hex(core_md5(str2binl(e),e.length*chrsz))}function core_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n=1732584193,i=-271733879,a=-1732584194,r=271733878,o=0;o<e.length;o+=16){var s=n,l=i,c=a,d=r;n=md5_ff(n,i,a,r,e[o+0],7,-680876936),r=md5_ff(r,n,i,a,e[o+1],12,-389564586),a=md5_ff(a,r,n,i,e[o+2],17,606105819),i=md5_ff(i,a,r,n,e[o+3],22,-1044525330),n=md5_ff(n,i,a,r,e[o+4],7,-176418897),r=md5_ff(r,n,i,a,e[o+5],12,1200080426),a=md5_ff(a,r,n,i,e[o+6],17,-1473231341),i=md5_ff(i,a,r,n,e[o+7],22,-45705983),n=md5_ff(n,i,a,r,e[o+8],7,1770035416),r=md5_ff(r,n,i,a,e[o+9],12,-1958414417),a=md5_ff(a,r,n,i,e[o+10],17,-42063),i=md5_ff(i,a,r,n,e[o+11],22,-1990404162),n=md5_ff(n,i,a,r,e[o+12],7,1804603682),r=md5_ff(r,n,i,a,e[o+13],12,-40341101),a=md5_ff(a,r,n,i,e[o+14],17,-1502002290),i=md5_ff(i,a,r,n,e[o+15],22,1236535329),n=md5_gg(n,i,a,r,e[o+1],5,-165796510),r=md5_gg(r,n,i,a,e[o+6],9,-1069501632),a=md5_gg(a,r,n,i,e[o+11],14,643717713),i=md5_gg(i,a,r,n,e[o+0],20,-373897302),n=md5_gg(n,i,a,r,e[o+5],5,-701558691),r=md5_gg(r,n,i,a,e[o+10],9,38016083),a=md5_gg(a,r,n,i,e[o+15],14,-660478335),i=md5_gg(i,a,r,n,e[o+4],20,-405537848),n=md5_gg(n,i,a,r,e[o+9],5,568446438),r=md5_gg(r,n,i,a,e[o+14],9,-1019803690),a=md5_gg(a,r,n,i,e[o+3],14,-187363961),i=md5_gg(i,a,r,n,e[o+8],20,1163531501),n=md5_gg(n,i,a,r,e[o+13],5,-1444681467),r=md5_gg(r,n,i,a,e[o+2],9,-51403784),a=md5_gg(a,r,n,i,e[o+7],14,1735328473),i=md5_gg(i,a,r,n,e[o+12],20,-1926607734),n=md5_hh(n,i,a,r,e[o+5],4,-378558),r=md5_hh(r,n,i,a,e[o+8],11,-2022574463),a=md5_hh(a,r,n,i,e[o+11],16,1839030562),i=md5_hh(i,a,r,n,e[o+14],23,-35309556),n=md5_hh(n,i,a,r,e[o+1],4,-1530992060),r=md5_hh(r,n,i,a,e[o+4],11,1272893353),a=md5_hh(a,r,n,i,e[o+7],16,-155497632),i=md5_hh(i,a,r,n,e[o+10],23,-1094730640),n=md5_hh(n,i,a,r,e[o+13],4,681279174),r=md5_hh(r,n,i,a,e[o+0],11,-358537222),a=md5_hh(a,r,n,i,e[o+3],16,-722521979),i=md5_hh(i,a,r,n,e[o+6],23,76029189),n=md5_hh(n,i,a,r,e[o+9],4,-640364487),r=md5_hh(r,n,i,a,e[o+12],11,-421815835),a=md5_hh(a,r,n,i,e[o+15],16,530742520),i=md5_hh(i,a,r,n,e[o+2],23,-995338651),n=md5_ii(n,i,a,r,e[o+0],6,-198630844),r=md5_ii(r,n,i,a,e[o+7],10,1126891415),a=md5_ii(a,r,n,i,e[o+14],15,-1416354905),i=md5_ii(i,a,r,n,e[o+5],21,-57434055),n=md5_ii(n,i,a,r,e[o+12],6,1700485571),r=md5_ii(r,n,i,a,e[o+3],10,-1894986606),a=md5_ii(a,r,n,i,e[o+10],15,-1051523),i=md5_ii(i,a,r,n,e[o+1],21,-2054922799),n=md5_ii(n,i,a,r,e[o+8],6,1873313359),r=md5_ii(r,n,i,a,e[o+15],10,-30611744),a=md5_ii(a,r,n,i,e[o+6],15,-1560198380),i=md5_ii(i,a,r,n,e[o+13],21,1309151649),n=md5_ii(n,i,a,r,e[o+4],6,-145523070),r=md5_ii(r,n,i,a,e[o+11],10,-1120210379),a=md5_ii(a,r,n,i,e[o+2],15,718787259),i=md5_ii(i,a,r,n,e[o+9],21,-343485551),n=safe_add(n,s),i=safe_add(i,l),a=safe_add(a,c),r=safe_add(r,d)}return Array(n,i,a,r)}function md5_cmn(e,t,n,i,a,r){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,r)),a),n)}function md5_ff(e,t,n,i,a,r,o){return md5_cmn(t&n|~t&i,e,t,a,r,o)}function md5_gg(e,t,n,i,a,r,o){return md5_cmn(t&i|n&~i,e,t,a,r,o)}function md5_hh(e,t,n,i,a,r,o){return md5_cmn(t^n^i,e,t,a,r,o)}function md5_ii(e,t,n,i,a,r,o){return md5_cmn(n^(t|~i),e,t,a,r,o)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}function str2binl(e){for(var t=Array(),n=(1<<chrsz)-1,i=0;i<e.length*chrsz;i+=chrsz)t[i>>5]|=(e.charCodeAt(i/chrsz)&n)<<i%32;return t}function binl2hex(e){for(var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n}function bind$2(){attentionBtn.addEventListener("click",function(){var e=JSON.parse(localStorage.getItem("loginSuc"));e?attention():login()}),cancelAttentionBtn.addEventListener("click",function(){localStorage.removeItem("followSuc"),_.addClass(hasAttentionBox,"z-hide"),_.removeClass(attentionBtn,"z-hide")})}function attention(){http({url:"http://study.163.com/webDev/attention.htm",type:"GET",dataType:"json"}).then(function(e){e&&(localStorage.setItem("followSuc",!0),_.addClass(attentionBtn,"z-hide"),_.removeClass(hasAttentionBox,"z-hide"))})}function login(){var e=document.querySelector(".m-login");if(e)return e.style.display="block";var t=document.createElement("div");_.addClass(t,"m-login"),t.innerHTML=['<div class="box">','<i class="close"></i>',"<h5>登录网易云课堂</h5>",'<input type="text" placeholder="帐号">','<input type="password" placeholder="密码">','<button class="j-login-btn">登&nbsp;录</button>',"</div>"].join(""),document.body.appendChild(t),t.querySelector(".close").addEventListener("click",function(){t.style.display="none"}),t.querySelector(".j-login-btn").addEventListener("click",function(){var e=t.querySelectorAll("input");http({url:"http://study.163.com/webDev/login.htm",data:{userName:md5.hex_md5(e[0].value),password:md5.hex_md5(e[1].value)},type:"GET",dataType:"json"}).then(function(e){return e?(t.style.display="none",localStorage.setItem("loginSuc",!0),void attention()):alert("用户名或密码错误，请重新登录")})})}function bind$3(){videoBtn.addEventListener("click",function(){var e=document.querySelector(".m-video");if(e)return e.style.display="block";var t=document.createElement("div");_.addClass(t,"m-video"),t.innerHTML=['<div class="box">','<i class="close"></i>',"<h5>登录网易云课堂</h5>",'<video controls="" poster="img/video_cover_sm.jpg" src="http://mov.bn.netease.com/open-movie/nos/mp4/2014/12/30/SADQ86F5S_shd.mp4">您的浏览器不支持html5播放器，请升级</video>',"</div>"].join(""),document.body.appendChild(t),t.querySelector(".close").addEventListener("click",function(){t.style.display="none"})})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),msg=document.querySelector(".j-msg"),storage={init:function(){var e=JSON.parse(localStorage.getItem("notShowMsg"));e||(msg.style.display="block"),this.bind()},bind:function(){msg.querySelector(".close").addEventListener("click",function(){localStorage.setItem("notShowMsg",!0),msg.style.display="none"})}},timer=void 0,fadeinTimer=void 0,fadeoutTimer=void 0,index=0,box=document.querySelector(".j-carousel"),slides=box.querySelectorAll("a"),pointers=box.querySelectorAll(".pointers li"),carousel={init:function(){start(),bind(),fadein(slides[index])}},_={exp:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return new RegExp(e,"g")},escapeHTML:function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e.replace(/&(?!#?[0-9A-Za-z]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},warn:function(){var e=arguments.length<=0||void 0===arguments[0]?"Global":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"something happened:)":arguments[1],n=e+" Warn: ";return console&&console.warn(n+t),n+t},isType:function(e,t){return"dom"===e?t instanceof HTMLElement:e===Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},addClass:addClass,removeClass:removeClass},Promise=function e(t){function n(e){if("PENDING"===o)return void l.push(e);var t="FULFILLED"===o?e.onFulfilled:e.onRejected,n=void 0;if(!t)return cd="FULFILLED"===o?e.resolve:e.reject,void cd(s);try{n=t(s),e.resolve(n)}catch(t){e.reject(t)}}function i(e){if(e&&(_.isType("object",e)||_.isType("function",e))){var t=e.then;if(_.isType("function",t))return void t.call(e,i,a)}o="FULFILLED",s=e,r()}function a(e){o="REJECTED",s=e,r()}function r(){setTimeout(function(){l.forEach(function(e){n(e)})},0)}_classCallCheck(this,e);var o="PENDING",s=null,l=[];this.then=function(){var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0],i=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return new e(function(e,a){n({onFulfilled:t,onRejected:i,resolve:e,reject:a})})},t(i,a)},config={open:"{{",close:"}}"},Tpl=function(){function e(t){_classCallCheck(this,e),this.tpl=t,this.cache=null}return _createClass(e,[{key:"parse",value:function(e,t){var n=_.exp,i=n("^"+config.open+"#",""),a=n(config.close+"$");e=e.replace(/[\r\t\n]/g," ").replace(n(config.open)+"#",config.open+"# ").replace(n(config.close+"}"),"} "+config.close).replace(/\\/g,"\\\\").replace(/(?="|')/g,"\\").replace(_query(),function(e){return e=e.replace(i,"").replace(a,""),'";'+e.replace(/\\/g,"")+'; view +="'}).replace(_query(1),function(e){var t='"+(';return e.replace(/\s/g,"")===config.open+config.close?"":(e=e.replace(n(config.open+"|"+config.close),""),/^=/.test(e)&&(e=e.replace(/^=/,""),t='"+html('),t+e.replace(/\\/g,"")+')+"')}),e='"use strict";var view = "'+e+'";return view;';try{return this.cache=e=new Function("data, html",e),e(t,_.escapeHTML)}catch(e){return this.cache=null,_.warn("Render",e)}}},{key:"render",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=void 0;return e?_.isType("function",t)?(n=this.cache?this.cache(e,_.escapeHTML):this.parse(this.tpl,e),t(n),n):_.warn("Render","arguments cb should be Function"):_.warn("Render","undefined data")}}]),e}(),Page=function(){function e(t){return _classCallCheck(this,e),t.el&&_.isType("dom",t.el)?t.total&&_.isType("number",t.total)?t.jump&&_.isType("function",t.jump)?(this.el=t.el,this.total=t.total,this.max=8,this.jump=t.jump,this.page=1,this.tpl={prev:'<a class="btns" href="javascript: void(0)" data-page="prev">&lt;</a>',next:'<a class="btns" href="javascript: void(0)" data-page="next">&gt;</a>',omit:'<span class="omit" data-page="omit">...</span>'},this.init(),void this.bind()):_warn("arguments.jump should be a Function"):_warn("arguments.total should be a Number"):_warn("arguments.el should be a DOM Element")}return _createClass(e,[{key:"getCurrTpl",value:function(){return'<span class="curr" data-page="curr">'+this.page+"</span>"}},{key:"init",value:function(){var e=this.tpl.prev+this.getCurrTpl();if(this.total>this.max){for(var t=this.max-3,n=0;n<t;n++)e+='<a class="links" href="javascript: void(0)" data-page="'+(n+2)+'">'+(n+2)+"</a>";e+=this.tpl.omit+'<a class="links" href="javascript: void(0)" data-page="'+this.total+'">'+this.total+"</a>"+this.tpl.next}else{for(var i=0,a=this.total;i<a-1;i++)e+='<a class="links" href="javascript: void(0)" data-page="'+(i+2)+'">'+(i+2)+"</a>";e+=this.tpl.next}this.el.innerHTML=e}},{key:"bind",value:function(){var e=this;this.el.addEventListener("click",function(t){var n=t||window.event,i=n.target.getAttribute("data-page");switch(i){case"omit":case"curr":break;case"prev":1!==e.page&&e.pageHandel(e.page-1);break;case"next":e.page!==e.total&&e.pageHandel(e.page+1);break;default:i&&e.pageHandel(parseInt(i))}})}},{key:"pageHandel",value:function(e){this.page=e;var t=this.max,n=this.total,i=0,a=0,r=0,o=[],s=[],l=t-1,c=e-1,d=n-e;for(o.push(this.getCurrTpl()),s.push("curr");i<l;){if(i<l&&++a<=c){var u=e-a;i++,o.unshift('<a class="links" href="javascript: void(0)" data-page="'+u+'">'+u+"</a>"),s.unshift(u)}if(i<l&&++r<=d){var p=e+r;i++,o.push('<a class="links" href="javascript: void(0)" data-page="'+p+'">'+p+"</a>"),s.push(p)}}2!==s[1]&&"curr"!==s[1]&&(o[0]='<a class="links" href="javascript: void(0)" data-page="1">1</a>',o[1]=this.tpl.omit),s[t-1]!==n&&"curr"!==s[t-1]&&(o[t-2]=this.tpl.omit,o[t-1]='<a class="links" href="javascript: void(0)" data-page="'+n+'">'+n+"</a>"),this.el.innerHTML=this.tpl.prev+o.join("")+this.tpl.next,this.jump(e)}}]),e}(),renderList=document.querySelector(".j-class-lst"),pageBox=document.querySelector(".m-page"),classTab=document.querySelector(".j-class-tab"),curr=1,screenCache=isLargeScreen(),psize=screenCache?20:15,classType=10,course={init:function(){_init(),bind$1()}},topBox=document.querySelector(".j-hot-top"),hot={init:function(){renderTopBox()}},hexcase=0,chrsz=8,md5={hex_md5:hex_md5},attentionBox=document.querySelector(".j-attention"),attentionBtn=attentionBox.querySelector(".at-btn"),hasAttentionBox=attentionBox.querySelector(".has-at"),cancelAttentionBtn=hasAttentionBox.querySelector("a"),login$1={init:function(){bind$2(),JSON.parse(localStorage.getItem("loginSuc"))&&JSON.parse(localStorage.getItem("followSuc"))&&(_.addClass(attentionBtn,"z-hide"),_.removeClass(hasAttentionBox,"z-hide"))}},videoBtn=document.querySelector(".u-video"),video={init:function(){bind$3()}};storage.init(),carousel.init(),course.init(),hot.init(),login$1.init(),video.init();